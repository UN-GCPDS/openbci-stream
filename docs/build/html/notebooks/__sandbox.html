
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>&lt;no title&gt; &#8212; OpenBCI-Stream  documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="shortcut icon" href="../_static/favico.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 0;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<style>
    .nbinput .prompt,
    .nboutput .prompt {
        display: none;
}
</style><div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">rawutil</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="c1"># from typing import Dict, Any</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">kafka</span> <span class="kn">import</span> <span class="n">KafkaProducer</span>

<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span><span class="p">,</span> <span class="n">Queue</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">RAW</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">id_</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;context&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;daisy&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                   <span class="s1">&#39;boardmode&#39;</span><span class="p">:</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;montage&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">ch</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="s1">&#39;Fp1,Fp2,T3,C3,C4,T4,O1,O2&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))},</span>
                   <span class="s1">&#39;connection&#39;</span><span class="p">:</span> <span class="s1">&#39;wifi&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;gain&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">]</span>
                   <span class="p">}</span>


<span class="n">data</span><span class="p">[</span><span class="s1">&#39;context&#39;</span><span class="p">][</span><span class="s1">&#39;created&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">aux_</span><span class="p">(</span><span class="n">v</span><span class="p">):</span> <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&gt;hhh&#39;</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">v</span> <span class="o">/</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">16</span> <span class="o">/</span> <span class="mf">0.002</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>

<span class="k">def</span> <span class="nf">eeg_</span><span class="p">(</span><span class="n">v</span><span class="p">):</span> <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">rawutil</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&gt;u&#39;</span><span class="p">,</span> <span class="o">-</span><span class="n">v</span> <span class="o">//</span> <span class="mi">24</span><span class="p">))</span> <span class="o">*</span> <span class="mi">8</span>
<span class="k">def</span> <span class="nf">t0</span><span class="p">():</span> <span class="k">return</span> <span class="p">((</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">//</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">if</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">//</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">aux</span> <span class="o">=</span> <span class="n">aux_</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">eeg</span> <span class="o">=</span> <span class="n">eeg_</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">aux</span> <span class="o">=</span> <span class="n">aux_</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">eeg</span> <span class="o">=</span> <span class="n">eeg_</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">data</span><span class="p">[</span><span class="s1">&#39;context&#39;</span><span class="p">][</span><span class="s1">&#39;created&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0xa0</span><span class="p">,</span>  <span class="c1"># header</span>
                <span class="n">id_</span> <span class="o">%</span> <span class="mi">256</span><span class="p">,</span>  <span class="c1"># ID 0-255</span>
                <span class="o">*</span><span class="n">eeg</span><span class="p">,</span>
                <span class="o">*</span><span class="n">aux</span><span class="p">,</span>
                <span class="mh">0xc0</span><span class="p">,</span>  <span class="c1"># footer</span>
                <span class="p">]</span> <span class="o">*</span> <span class="mi">10000</span>

<span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
<span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
330000
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>

<span></span><span class="c1">########################################################################</span>
<span class="k">class</span> <span class="nc">Deserialize</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor&quot;&quot;&quot;</span>

        <span class="c1"># self.deserialize(data, context)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_last_marker</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">remnant</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_aux_shape</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;From signed 24-bits integer to signed 32-bits integer.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data</span>
<span class="sd">            Numpy array of shape (`33, LENGTH`)</span>
<span class="sd">        context</span>
<span class="sd">            Information from the acquisition side useful for deserializing and</span>
<span class="sd">            that will be packaged back in the stream.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># EGG</span>
        <span class="n">eeg_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">26</span><span class="p">]</span>
        <span class="n">eeg_data</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;deserialize_eeg_</span><span class="si">{</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;connection&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)(</span>
            <span class="n">eeg_data</span><span class="p">,</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">context</span><span class="p">)</span>


        <span class="c1"># Auxiliar</span>
        <span class="c1"># stop_byte = data[0][-1]</span>
        <span class="n">stop_byte</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])))</span>

        <span class="n">aux</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_aux</span><span class="p">(</span><span class="n">stop_byte</span><span class="p">,</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">26</span><span class="p">:</span><span class="mi">32</span><span class="p">],</span> <span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_aux_shape</span> <span class="o">=</span> <span class="n">aux</span><span class="o">.</span><span class="n">shape</span>


        <span class="c1"># Stream</span>
        <span class="n">channels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;montage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">eeg_data</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">channels</span><span class="p">],</span> <span class="n">aux</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="c1"># ----------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">deserialize_eeg_wifi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eeg</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">ids</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;From signed 24-bits integer to signed 32-bits integer by channels.</span>

<span class="sd">        The `Cyton data format &lt;https://docs.openbci.com/docs/02Cyton/CytonDataFormat&gt;`_</span>
<span class="sd">        says that only can send packages of 33 bits, when a Daisy board is</span>
<span class="sd">        attached these same packages will be sent at double speed in favor to</span>
<span class="sd">        keep the desired sample rate for 16 channels.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        eeg</span>
<span class="sd">            Numpy array in signed 24-bits integer (`8, LENGTH`)</span>
<span class="sd">        ids</span>
<span class="sd">            List of IDs for eeg data.</span>
<span class="sd">        context</span>
<span class="sd">            Information from the acquisition side useful for deserializing and</span>
<span class="sd">            that will be packaged back in the stream.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        eeg_data</span>
<span class="sd">            EEG data in microvolts, signed 32-bits integer, (`CHANNELS, LENGTH`),</span>
<span class="sd">            if there is a Daisy board `CHANNELS` is 16, otherwise is 8.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">RAW</span>

        <span class="n">RAW</span> <span class="o">=</span> <span class="n">eeg</span>
        <span class="n">eeg_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">rawutil</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&gt;u&#39;</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">ch</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">eeg</span><span class="p">])</span>

        <span class="n">eeg_data</span> <span class="o">=</span> <span class="n">eeg_data</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_factor_eeg</span>

        <span class="k">if</span> <span class="n">context</span><span class="p">[</span><span class="s1">&#39;daisy&#39;</span><span class="p">]:</span>

            <span class="c1"># # If offset, the pair index condition must change</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="n">eeg_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">eeg_data</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">ids</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="c1"># pair = not pair</span>

            <span class="k">if</span> <span class="n">ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ids</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">eeg_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">eeg_data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># if not pair dataset, create an offeset</span>
            <span class="k">if</span> <span class="n">eeg_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">eeg_data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ids</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">eeg_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">eeg_data</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

            <span class="k">return</span> <span class="n">eeg_data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>


        <span class="k">return</span> <span class="n">eeg_data</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">deserialize_eeg_serial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eeg</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">ids</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;From signed 24-bits integer to signed 32-bits integer by channels.</span>

<span class="sd">        The `Cyton data format &lt;https://docs.openbci.com/docs/02Cyton/CytonDataFormat&gt;`_</span>
<span class="sd">        says that only can send packages of 33 bits, over serial (RFduino) this</span>
<span class="sd">        limit is absolute, when a Daisy board is attached these same amount of</span>
<span class="sd">        packages will be sent, in this case, the data must be distributed and</span>
<span class="sd">        interpolated in order to complete the sample rate.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        eeg</span>
<span class="sd">            Numpy array in signed 24-bits integer (`8, LENGTH`)</span>
<span class="sd">        ids</span>
<span class="sd">            List of IDs for eeg data.</span>
<span class="sd">        context</span>
<span class="sd">            Information from the acquisition side useful for deserializing and</span>
<span class="sd">            that will be packaged back in the stream.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        eeg_data</span>
<span class="sd">            EEG data in microvolts, signed 32-bits integer, (`CHANNELS, LENGTH`),</span>
<span class="sd">            if there is a Daisy board `CHANNELS` is 16, otherwise is 8.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">eeg_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">rawutil</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&gt;u&#39;</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">ch</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                              <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">eeg</span><span class="p">])</span>
        <span class="n">eeg_data</span> <span class="o">=</span> <span class="n">eeg_data</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_factor_eeg</span>

        <span class="n">eeg_data</span> <span class="o">=</span> <span class="n">eeg_data</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">context</span><span class="p">[</span><span class="s1">&#39;daisy&#39;</span><span class="p">]:</span>

            <span class="n">even</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="mi">2</span>

            <span class="c1"># If offset, the even index condition must change</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="n">eeg_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">eeg_data</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">ids</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">even</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">even</span>

            <span class="c1"># if not even dataset, create an offset</span>
            <span class="k">if</span> <span class="n">eeg_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">eeg_data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ids</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">eeg_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">eeg_data</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># Data can start with a even or odd id</span>
            <span class="k">if</span> <span class="n">even</span><span class="p">:</span>
                <span class="n">board</span> <span class="o">=</span> <span class="n">eeg_data</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">daisy</span> <span class="o">=</span> <span class="n">eeg_data</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">daisy</span> <span class="o">=</span> <span class="n">eeg_data</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">board</span> <span class="o">=</span> <span class="n">eeg_data</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>

            <span class="n">board</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
                <span class="n">p</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">board</span><span class="o">.</span><span class="n">T</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
            <span class="n">daisy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
                <span class="n">p</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">daisy</span><span class="o">.</span><span class="n">T</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>

            <span class="n">eeg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">board</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">daisy</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">eeg</span> <span class="o">=</span> <span class="n">eeg_data</span>

        <span class="k">return</span> <span class="n">eeg</span>

    <span class="c1"># ----------------------------------------------------------------------</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">scale_factor_eeg</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Vector with the correct factors for scale eeg data samples.&quot;&quot;&quot;</span>
        <span class="n">gain</span> <span class="o">=</span> <span class="mi">24</span>
        <span class="c1"># vref = 4.5  # for V</span>
        <span class="n">vref</span> <span class="o">=</span> <span class="mi">4500000</span>  <span class="c1"># for uV</span>

        <span class="k">return</span> <span class="n">vref</span> <span class="o">/</span> <span class="p">(</span><span class="n">gain</span> <span class="o">*</span> <span class="p">((</span><span class="mi">2</span> <span class="o">**</span> <span class="mi">23</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

    <span class="c1"># ----------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">deserialize_aux</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stop_byte</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">aux</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Determine the content of `AUX` bytes and format it.</span>

<span class="sd">        Auxialiar data could contain different kind of information: accelometer,</span>
<span class="sd">        user defined, time stamped and digital or analog inputs.</span>
<span class="sd">        The context of `AUX` bytes are determined by the stop byte.</span>

<span class="sd">        If `stop_byte` is `0xc0` the `AUX` bytes contain `Standard with accel`,</span>
<span class="sd">        this data are packaged at different frequency, they will be show up each</span>
<span class="sd">        10 or 11 packages, the final list will contain accelometer value in `G`</span>
<span class="sd">        units for axis `X`, `Y` and `Z` respectively and `None` when are not</span>
<span class="sd">        availables.</span>

<span class="sd">        If `stop_byte` is `0xc1` the `AUX` bytes contain `Standard with raw aux`,</span>
<span class="sd">        there are 3 types of raw data: `digital` in wich case the final list</span>
<span class="sd">        will contain the values for `D11`, `D12`, `D13`, `D17`, `D18`; `analog`</span>
<span class="sd">        with the values for `A7` (`D13`), `A6` (`D12`), `A5` (`D11`); `markers`</span>
<span class="sd">        data contain the the marker sended with `send_marker()` method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        stop_byte</span>
<span class="sd">             0xCX where X is 0-F in hex.</span>
<span class="sd">        aux</span>
<span class="sd">            6 bytes of data defined and parsed based on the `Footer` bytes.</span>
<span class="sd">        context</span>
<span class="sd">            Information from the acquisition side useful for deserializing and</span>
<span class="sd">            that will be packaged back in the stream.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            Correct data formated.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Standard with accel</span>
        <span class="k">if</span> <span class="n">stop_byte</span> <span class="o">==</span> <span class="mh">0xc0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.002</span> <span class="o">*</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&gt;hhh&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;i1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">())</span>
                          <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">aux</span><span class="p">])</span> <span class="o">/</span> <span class="mi">16</span>

        <span class="c1"># Standard with raw aux</span>
        <span class="k">elif</span> <span class="n">stop_byte</span> <span class="o">==</span> <span class="mh">0xc1</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">context</span><span class="p">[</span><span class="s1">&#39;boardmode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;analog&#39;</span><span class="p">:</span>
                <span class="c1"># A7, A6, A5</span>
                <span class="c1"># D13, D12, D11</span>
                <span class="k">return</span> <span class="n">aux</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>

            <span class="k">elif</span> <span class="n">context</span><span class="p">[</span><span class="s1">&#39;boardmode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;digital&#39;</span><span class="p">:</span>
                <span class="c1"># D11, D12, D13, D17, D18</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">aux</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">context</span><span class="p">[</span><span class="s1">&#39;boardmode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;marker&#39;</span><span class="p">:</span>
                <span class="c1"># Some time for some reason, marker not always send back from</span>
                <span class="c1"># OpenBCI, so this module implement a strategy to send a burst of</span>
                <span class="c1"># markers but read back only one.</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">a</span><span class="p">[</span><span class="n">a</span> <span class="o">&gt;</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">a</span><span class="p">[</span><span class="n">a</span> <span class="o">&lt;</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">return</span> <span class="n">a</span>

        <span class="c1"># User defined</span>
        <span class="k">elif</span> <span class="n">stop_byte</span> <span class="o">==</span> <span class="mh">0xc2</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># Time stamped set with accel</span>
        <span class="k">elif</span> <span class="n">stop_byte</span> <span class="o">==</span> <span class="mh">0xc3</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># Time stamped with accel</span>
        <span class="k">elif</span> <span class="n">stop_byte</span> <span class="o">==</span> <span class="mh">0xc4</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># Time stamped set with raw auxcalculate_sample_rate</span>
        <span class="k">elif</span> <span class="n">stop_byte</span> <span class="o">==</span> <span class="mh">0xc5</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># Time stamped with raw aux</span>
        <span class="k">elif</span> <span class="n">stop_byte</span> <span class="o">==</span> <span class="mh">0xc6</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_last_aux_shape</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eeg_queue</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Kafka produser.</span>

<span class="sd">        Stream data to network.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : list</span>
<span class="sd">            The EEG data format.</span>
<span class="sd">        samples : int</span>
<span class="sd">            The number of samples in this package.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">context</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;samples&#39;</span><span class="p">:</span> <span class="n">samples</span><span class="p">})</span>
        <span class="c1"># context[&#39;created&#39;] = datetime.now().timestamp()</span>

        <span class="n">data_</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;context&#39;</span><span class="p">:</span> <span class="n">context</span><span class="p">,</span>
                 <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span>
                 <span class="c1"># &#39;binary_created&#39;: self.created,</span>
                 <span class="c1"># &#39;created&#39;: datetime.now().timestamp(),</span>
                 <span class="c1"># &#39;samples&#39;: samples,</span>
                 <span class="p">}</span>

        <span class="c1"># self.producer_eeg.send(&#39;eeg&#39;, data_)</span>
        <span class="n">eeg_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">data_</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;streamed </span><span class="si">{</span><span class="n">samples</span><span class="si">}</span><span class="s2"> samples&quot;</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">BIN_HEADER</span> <span class="o">=</span> <span class="mh">0xa0</span>
<span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># ----------------------------------------------------------------------</span>
<span class="k">def</span> <span class="nf">align_data</span><span class="p">(</span><span class="n">binary</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Align data following the headers and footers.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    binary</span>
<span class="sd">        Data raw from OpenBCI board.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    data_aligned</span>
<span class="sd">        Numpy array of shape (`33, LENGTH`) with headers and footer aligned.</span>
<span class="sd">    remnant</span>
<span class="sd">        This bytes could be used for complete next binary input.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">binary</span><span class="p">))</span>

    <span class="c1"># Search for the the first index with a `BIN_HEADER`</span>
    <span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[::</span><span class="mi">33</span><span class="p">])</span>
             <span class="o">==</span> <span class="n">BIN_HEADER</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">33</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">start</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="mi">33</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">data_aligned</span> <span class="o">=</span> <span class="n">data</span>
        <span class="n">remnant</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Fix the offset to complete 33 bytes divisible array</span>
        <span class="n">end</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">%</span> <span class="mi">33</span>
        <span class="n">data_aligned</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="o">-</span><span class="n">end</span><span class="p">]</span>
        <span class="n">remnant</span> <span class="o">=</span> <span class="n">binary</span><span class="p">[</span><span class="o">-</span><span class="n">end</span><span class="p">:]</span>

    <span class="n">data_aligned</span> <span class="o">=</span> <span class="n">data_aligned</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">33</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data_aligned</span><span class="p">,</span> <span class="n">remnant</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">des</span> <span class="o">=</span> <span class="n">Deserialize</span><span class="p">()</span>
<span class="c1"># def dess(d):</span>
<span class="c1">#     return des.deserialize(d, data[&#39;context&#39;])</span>

<span class="n">dess</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span><span class="n">des</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;context&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">data_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">align_data</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
<span class="n">dess</span><span class="p">(</span><span class="n">data_</span><span class="p">)</span>

<span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total:&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">t1</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Total: 667.4270629882812
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">data_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">align_data</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">dess</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array_split</span><span class="p">(</span><span class="n">data_</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
    <span class="n">e</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">q</span><span class="p">)</span>
<span class="c1">#     print(e[0].shape)</span>

<span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">((</span><span class="n">t1</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
822.4489688873291
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[114]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">RAW</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[114]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(10000, 24)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[142]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>


<span></span><span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">rawutil</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&gt;u&#39;</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">ch</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">RAW</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">((</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">_24to8</span><span class="p">,</span> <span class="n">RAW</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">((</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span>



<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rawutil</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&gt;u&#39;</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">ch</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">RAW</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="nb">print</span><span class="p">((</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(10000, 8)
619.3513870239258
######################################################################
(10000, 8)
744.1587448120117
######################################################################
(10000, 8)
661.1278057098389
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[120]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rawutil</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&gt;u&#39;</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">a3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[120]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[0]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[98]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">bytes</span><span class="p">(</span><span class="n">a3</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[98]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
b&#39;\x00\x00\x00&#39;
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[82]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">signs</span> <span class="o">=</span> <span class="p">(</span><span class="n">a3</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="o">*</span> <span class="mh">0xff</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[87]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">a4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">signs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">a3</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[198]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">rawutil</span><span class="o">.</span><span class="n">iter_unpack</span><span class="p">(</span><span class="s1">&#39;&gt;24u&#39;</span><span class="p">,</span> <span class="n">RAW</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))))</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">((</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">IndexError</span>                                Traceback (most recent call last)
<span class="ansi-green-fg">~/.local/lib/python3.9/site-packages/rawutil.py</span> in <span class="ansi-cyan-fg">_unpack_file</span><span class="ansi-blue-fg">(self, data, tokens, refdata)</span>
<span class="ansi-green-intense-fg ansi-bold">    502</span>                                         signed<span class="ansi-blue-fg">,</span> size <span class="ansi-blue-fg">=</span> _INTEGER_ELEMENTS<span class="ansi-blue-fg">[</span>token<span class="ansi-blue-fg">.</span>type<span class="ansi-blue-fg">]</span>
<span class="ansi-green-fg">--&gt; 503</span><span class="ansi-red-fg">                                         </span>groupdata <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_read<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">,</span> size <span class="ansi-blue-fg">*</span> count<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    504</span>                                         <span class="ansi-green-fg">for</span> i <span class="ansi-green-fg">in</span> range<span class="ansi-blue-fg">(</span>count<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/.local/lib/python3.9/site-packages/rawutil.py</span> in <span class="ansi-cyan-fg">_read</span><span class="ansi-blue-fg">(self, data, length)</span>
<span class="ansi-green-intense-fg ansi-bold">    382</span>                 <span class="ansi-green-fg">if</span> len<span class="ansi-blue-fg">(</span>read<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">&lt;</span> length<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 383</span><span class="ansi-red-fg">                         </span><span class="ansi-green-fg">raise</span> IndexError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;Not enough data to read&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    384</span>                 <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>

<span class="ansi-red-fg">IndexError</span>: Not enough data to read

During handling of the above exception, another exception occurred:

<span class="ansi-red-fg">OperationError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-198-b6a9ba275044&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> t0 <span class="ansi-blue-fg">=</span> time<span class="ansi-blue-fg">.</span>time<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span>print<span class="ansi-blue-fg">(</span>np<span class="ansi-blue-fg">.</span>array<span class="ansi-blue-fg">(</span>list<span class="ansi-blue-fg">(</span>rawutil<span class="ansi-blue-fg">.</span>iter_unpack<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;&gt;24u&#39;</span><span class="ansi-blue-fg">,</span> RAW<span class="ansi-blue-fg">.</span>reshape<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">3</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>shape<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> print<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">(</span>time<span class="ansi-blue-fg">.</span>time<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">-</span>t0<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">*</span><span class="ansi-cyan-fg">1000</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/.local/lib/python3.9/site-packages/rawutil.py</span> in <span class="ansi-cyan-fg">iter_unpack</span><span class="ansi-blue-fg">(self, data, names, refdata)</span>
<span class="ansi-green-intense-fg ansi-bold">    336</span>                 buffer<span class="ansi-blue-fg">.</span>seek<span class="ansi-blue-fg">(</span>pos<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    337</span>                 <span class="ansi-green-fg">while</span> buffer<span class="ansi-blue-fg">.</span>tell<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">&lt;</span> end<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 338</span><span class="ansi-red-fg">                         </span>unpacked <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_unpack_file<span class="ansi-blue-fg">(</span>buffer<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>tokens<span class="ansi-blue-fg">,</span> refdata<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    339</span>                         <span class="ansi-green-fg">if</span> hasattr<span class="ansi-blue-fg">(</span>names<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;_fields&#39;</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">and</span> hasattr<span class="ansi-blue-fg">(</span>names<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;_asdict&#39;</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>  <span class="ansi-red-fg">#trying to recognize a namedtuple</span>
<span class="ansi-green-intense-fg ansi-bold">    340</span>                                 unpacked <span class="ansi-blue-fg">=</span> names<span class="ansi-blue-fg">(</span>unpacked<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/.local/lib/python3.9/site-packages/rawutil.py</span> in <span class="ansi-cyan-fg">_unpack_file</span><span class="ansi-blue-fg">(self, data, tokens, refdata)</span>
<span class="ansi-green-intense-fg ansi-bold">    552</span>                                         unpacked<span class="ansi-blue-fg">.</span>append<span class="ansi-blue-fg">(</span>elementdata<span class="ansi-blue-fg">.</span>hex<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    553</span>                         <span class="ansi-green-fg">except</span> IndexError<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 554</span><span class="ansi-red-fg">                                 </span><span class="ansi-green-fg">raise</span> OperationError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;No data remaining to read element &#39;&#34;</span> <span class="ansi-blue-fg">+</span> token<span class="ansi-blue-fg">.</span>type <span class="ansi-blue-fg">+</span> <span class="ansi-blue-fg">&#34;&#39;&#34;</span><span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>format<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    555</span>
<span class="ansi-green-intense-fg ansi-bold">    556</span>                 <span class="ansi-green-fg">return</span> unpacked

<span class="ansi-red-fg">OperationError</span>: In format &#39;24u&#39; : No data remaining to read element &#39;u&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[74]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">RAW</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[74]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(10000, 24)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[156]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="p">[</span><span class="n">rawutil</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;8&gt;u&#39;</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">d</span><span class="p">))</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">RAW</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">FormatError</span>                               Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-156-0f50217b1a7c&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span><span class="ansi-blue-fg">[</span>rawutil<span class="ansi-blue-fg">.</span>unpack<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;8&gt;u&#39;</span><span class="ansi-blue-fg">,</span> bytes<span class="ansi-blue-fg">(</span>d<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">for</span> d <span class="ansi-green-fg">in</span> RAW<span class="ansi-blue-fg">.</span>reshape<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">8</span><span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">3</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">]</span>

<span class="ansi-green-fg">&lt;ipython-input-156-0f50217b1a7c&gt;</span> in <span class="ansi-cyan-fg">&lt;listcomp&gt;</span><span class="ansi-blue-fg">(.0)</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span><span class="ansi-blue-fg">[</span>rawutil<span class="ansi-blue-fg">.</span>unpack<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;8&gt;u&#39;</span><span class="ansi-blue-fg">,</span> bytes<span class="ansi-blue-fg">(</span>d<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">for</span> d <span class="ansi-green-fg">in</span> RAW<span class="ansi-blue-fg">.</span>reshape<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">8</span><span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">3</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">]</span>

<span class="ansi-green-fg">~/.local/lib/python3.9/site-packages/rawutil.py</span> in <span class="ansi-cyan-fg">unpack</span><span class="ansi-blue-fg">(structure, data, names, refdata)</span>
<span class="ansi-green-intense-fg ansi-bold">    996</span>
<span class="ansi-green-intense-fg ansi-bold">    997</span> <span class="ansi-green-fg">def</span> unpack<span class="ansi-blue-fg">(</span>structure<span class="ansi-blue-fg">,</span> data<span class="ansi-blue-fg">,</span> names<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> refdata<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 998</span><span class="ansi-red-fg">         </span>stct <span class="ansi-blue-fg">=</span> Struct<span class="ansi-blue-fg">(</span>structure<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    999</span>         <span class="ansi-green-fg">return</span> stct<span class="ansi-blue-fg">.</span>unpack<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">,</span> names<span class="ansi-blue-fg">,</span> refdata<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1000</span>

<span class="ansi-green-fg">~/.local/lib/python3.9/site-packages/rawutil.py</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, format, names)</span>
<span class="ansi-green-intense-fg ansi-bold">    153</span>                         self<span class="ansi-blue-fg">.</span>byteorder <span class="ansi-blue-fg">=</span> sys<span class="ansi-blue-fg">.</span>byteorder
<span class="ansi-green-intense-fg ansi-bold">    154</span>                         self<span class="ansi-blue-fg">.</span>forcebyteorder <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">False</span>
<span class="ansi-green-fg">--&gt; 155</span><span class="ansi-red-fg">                         </span>self<span class="ansi-blue-fg">.</span>parse_struct<span class="ansi-blue-fg">(</span>format<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    156</span>                 <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    157</span>                         self<span class="ansi-blue-fg">.</span>format <span class="ansi-blue-fg">=</span> format

<span class="ansi-green-fg">~/.local/lib/python3.9/site-packages/rawutil.py</span> in <span class="ansi-cyan-fg">parse_struct</span><span class="ansi-blue-fg">(self, format)</span>
<span class="ansi-green-intense-fg ansi-bold">    172</span>                         self<span class="ansi-blue-fg">.</span>format <span class="ansi-blue-fg">=</span> format <span class="ansi-blue-fg">=</span> format<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">:</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">    173</span>
<span class="ansi-green-fg">--&gt; 174</span><span class="ansi-red-fg">                 </span>self<span class="ansi-blue-fg">.</span>tokens <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>parse_substructure<span class="ansi-blue-fg">(</span>format<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    175</span>
<span class="ansi-green-intense-fg ansi-bold">    176</span>         <span class="ansi-green-fg">def</span> preprocess<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> format<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/.local/lib/python3.9/site-packages/rawutil.py</span> in <span class="ansi-cyan-fg">parse_substructure</span><span class="ansi-blue-fg">(self, format)</span>
<span class="ansi-green-intense-fg ansi-bold">    235</span>                         <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>  <span class="ansi-red-fg"># Standard structure elements</span>
<span class="ansi-green-intense-fg ansi-bold">    236</span>                                 <span class="ansi-green-fg">if</span> format<span class="ansi-blue-fg">[</span>ptr<span class="ansi-blue-fg">]</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">in</span> _STRUCTURE_CHARACTERS<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 237</span><span class="ansi-red-fg">                                         </span><span class="ansi-green-fg">raise</span> FormatError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;Unrecognised character &#39;&#34;</span> <span class="ansi-blue-fg">+</span> format<span class="ansi-blue-fg">[</span>ptr<span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">+</span> <span class="ansi-blue-fg">&#34;&#39;&#34;</span><span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>format<span class="ansi-blue-fg">,</span> format<span class="ansi-blue-fg">,</span> startptr<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    238</span>                                 <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    239</span>                                         type <span class="ansi-blue-fg">=</span> format<span class="ansi-blue-fg">[</span>ptr<span class="ansi-blue-fg">]</span>

<span class="ansi-red-fg">FormatError</span>: In format &#39;8&gt;u&#39;, in subformat &#39;8&gt;u&#39;, at position 0 : Unrecognised character &#39;&gt;&#39;
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[130]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">pathos.multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
</pre></div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo.svg" alt="Logo"/>
            </a></p>
<h3><a href="../index.html">Table of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="00-installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="01-hardware_configurations.html">Hardware configurations</a></li>
<li class="toctree-l1"><a class="reference internal" href="02-kafka_configuration.html">Kafka configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="03-data_acquisition.html">Data Acquisition</a></li>
<li class="toctree-l1"><a class="reference internal" href="04-board_modes.html">Board modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="05-stream_markers.html">Stream markers with Kafka</a></li>
<li class="toctree-l1"><a class="reference internal" href="06-command_line_interface.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="07-data_storage_handler.html">Data storage handler</a></li>
<li class="toctree-l1"><a class="reference internal" href="A1-raw_cleaning.html">Appendix 1 - Raw data processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="A2-electrodes_impedance.html">Appendix 2 - Measuring Electrode Impedance</a></li>
<li class="toctree-l1"><a class="reference internal" href="A3-server-based_acquisition.html">Appendix 3 - Raspberry PI as server acquisition</a></li>
<li class="toctree-l1"><a class="reference internal" href="A4-latencies.html">Appendix 4 - System latencies</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019-2021, Yeison Cardona.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.5.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/notebooks/__sandbox.ipynb"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>