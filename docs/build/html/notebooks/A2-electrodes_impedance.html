
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Appendix 2 - Measuring Electrode Impedance &#8212; OpenBCI-Stream  documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="shortcut icon" href="../_static/favico.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Appendix 3 - Raspberry PI as server acquisition" href="A3-server-based_acquisition.html" />
    <link rel="prev" title="Appendix 1 - Raw data processing" href="A1-raw_cleaning.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 0;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<style>
    .nbinput .prompt,
    .nboutput .prompt {
        display: none;
}
</style><div class="section" id="Appendix-2---Measuring-Electrode-Impedance">
<h1>Appendix 2 - Measuring Electrode Impedance<a class="headerlink" href="#Appendix-2---Measuring-Electrode-Impedance" title="Permalink to this headline">¶</a></h1>
<p>The measuring of impedance in the <code class="docutils literal notranslate"><span class="pre">ADS1299</span></code> is made it by injecting a <code class="docutils literal notranslate"><span class="pre">6nA</span></code> altern current at <code class="docutils literal notranslate"><span class="pre">31.2</span> <span class="pre">Hz</span></code>, in this example will be measured the impedande in the <code class="docutils literal notranslate"><span class="pre">N</span></code> inputs (like used for single reference EEG montages), and will be use the <code class="docutils literal notranslate"><span class="pre">leadoff_impedance</span></code> method to set these inputs in the correct mode.</p>
<p>The first step is to connect correctly the Cyton board to replicate this experiment, a <code class="docutils literal notranslate"><span class="pre">10K</span></code> potentiometer will be connected between the <code class="docutils literal notranslate"><span class="pre">N</span></code> input (bottom) of channel 1 and the <code class="docutils literal notranslate"><span class="pre">SRB2</span></code> (bottom), the <code class="docutils literal notranslate"><span class="pre">BIAS</span></code> pin will not be used in this guide, <em>if you want to test with your head instead of a potentiometer then you must use this pin</em>.</p>
<div class="admonition warning">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The impedance measurement does not work correctly on the current version of Cyton Library, but there is a <a class="reference external" href="https://github.com/OpenBCI/OpenBCI_Cyton_Library/pull/95">pull request</a> that solve this issue.</p></li>
<li><p>Is possible to use versions between V3.0.0 and V3.1.2, but you must reset the board every time before measurement and NEVER change the sample frequency.</p></li>
</ul>
</div>
<div class="section" id="Offline-measurement">
<h2>Offline measurement<a class="headerlink" href="#Offline-measurement" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># openbci = Cyton(&#39;serial&#39;, &#39;/dev/ttyUSB1&#39;, capture_stream=True, daisy=False)</span>
<span class="n">openbci</span> <span class="o">=</span> <span class="n">Cyton</span><span class="p">(</span><span class="s1">&#39;wifi&#39;</span><span class="p">,</span> <span class="s1">&#39;192.168.1.113&#39;</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;192.168.1.1&#39;</span><span class="p">,</span> <span class="n">capture_stream</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">daisy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">openbci</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">cons</span><span class="o">.</span><span class="n">SAMPLE_RATE_250SPS</span><span class="p">)</span>
<span class="n">openbci</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">cons</span><span class="o">.</span><span class="n">DEFAULT_CHANNELS_SETTINGS</span><span class="p">)</span>
<span class="n">openbci</span><span class="o">.</span><span class="n">leadoff_impedance</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">pchan</span><span class="o">=</span><span class="n">cons</span><span class="o">.</span><span class="n">TEST_SIGNAL_NOT_APPLIED</span><span class="p">,</span> <span class="n">nchan</span><span class="o">=</span><span class="n">cons</span><span class="o">.</span><span class="n">TEST_SIGNAL_APPLIED</span><span class="p">)</span>

<span class="n">openbci</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="n">data_raw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">openbci</span><span class="o">.</span><span class="n">eeg_time_series</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">show</span><span class="p">([</span><span class="n">data_raw</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_A2-electrodes_impedance_5_0.png" src="../_images/notebooks_A2-electrodes_impedance_5_0.png" />
</div>
</div>
<p>We still not see a sinusoidal at <code class="docutils literal notranslate"><span class="pre">31.2</span> <span class="pre">Hz</span></code> but there is one, so, with a filter:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">band_2737</span> <span class="o">=</span> <span class="n">GenericButterBand</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">filter_impedance</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">notch60</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">band_2737</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">filter_impedance</span><span class="p">(</span><span class="n">data_raw</span><span class="p">)</span>
<span class="c1"># data = data[:, 100:-100]</span>

<span class="n">show</span><span class="p">([</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:root:Compiled `Butter` filter (27|37 Hz) for 250.00 Hz
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_A2-electrodes_impedance_7_1.png" src="../_images/notebooks_A2-electrodes_impedance_7_1.png" />
</div>
</div>
<p>Now we need the <code class="docutils literal notranslate"><span class="pre">RMS</span></code> voltage, there is a lot of formulas to get this value, even using the <code class="docutils literal notranslate"><span class="pre">std</span></code>, but I like to use one based on the <code class="docutils literal notranslate"><span class="pre">VPP</span></code>:</p>
<div class="math notranslate nohighlight">
\[V_{RMS}=\frac{V_{pp}}{2\sqrt{2}}\sim std(V)\]</div>
<p>Our <code class="docutils literal notranslate"><span class="pre">Vpp</span></code> can be calculated as the <em>maximun</em> - <em>minimum</em>. In some approaches, is very common to found the usage of <code class="docutils literal notranslate"><span class="pre">standard</span> <span class="pre">deviation</span></code> instead of RMS.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">get_rms</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="c1">#     return (v.max()-v.min())/(2*np.sqrt(2))</span>

<span class="n">rms</span> <span class="o">=</span> <span class="n">get_rms</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">rms</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
24.359166882658073
</pre></div></div>
</div>
<div class="math notranslate nohighlight">
\[Z=\frac{V_{RMS}}{I_{RMS}}\]</div>
<p>We know that the <code class="docutils literal notranslate"><span class="pre">ADS1299</span></code> injects a <code class="docutils literal notranslate"><span class="pre">6nA</span></code> of alternating current, so:</p>
<div class="math notranslate nohighlight">
\[I_{RMS}=\frac{6nA}{\sqrt{2}}\]</div>
<p>Then, considering that we have <code class="docutils literal notranslate"><span class="pre">uV</span></code> instaead of <code class="docutils literal notranslate"><span class="pre">V</span></code>:</p>
<div class="math notranslate nohighlight">
\[Z=\frac{\mu V_{RMS}\cdot10^{-6}\cdot\sqrt{2}}{6\cdot10^{-9}}\]</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">get_z</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="n">rms</span> <span class="o">=</span> <span class="n">get_rms</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">return</span> <span class="mf">1e-6</span> <span class="o">*</span> <span class="n">rms</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mf">6e-9</span>

<span class="n">z</span> <span class="o">=</span> <span class="n">get_z</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;For </span><span class="si">{</span><span class="n">rms</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> uVrms the electrode impedance is </span><span class="si">{</span><span class="n">z</span><span class="o">/</span><span class="mi">1000</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> KOhm&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
For 24.36 uVrms the electrode impedance is 5.74 KOhm
</pre></div></div>
</div>
<p>The Cyton board has a 2.2K Ohm resistors in series with each electrode, so we must remove this value in way to get the real one.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">get_z</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="n">rms</span> <span class="o">=</span> <span class="n">get_rms</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1e-6</span> <span class="o">*</span> <span class="n">rms</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mf">6e-9</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2200</span>
    <span class="k">if</span> <span class="n">z</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">z</span>

<span class="n">z</span> <span class="o">=</span> <span class="n">get_z</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;For </span><span class="si">{</span><span class="n">rms</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> uVrms the electrode-to-head impedance is </span><span class="si">{</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> KOhm&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
For 24.36 uVrms the electrode-to-head impedance is 3.54 KOhm
</pre></div></div>
</div>
</div>
<div class="section" id="Real-time-measurement">
<h2>Real time measurement<a class="headerlink" href="#Real-time-measurement" title="Permalink to this headline">¶</a></h2>
<p>For this experiment we will use the Kafka consumer interface, and the same potentiometer. Keep in mind that this measurement uses 1 second signal, so, the variance will affect the real measure, in real-life the amplitude not change so drastically.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="n">Z</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">with</span> <span class="n">OpenBCIConsumer</span><span class="p">(</span><span class="s1">&#39;wifi&#39;</span><span class="p">,</span> <span class="s1">&#39;192.168.1.113&#39;</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;192.168.1.1&#39;</span><span class="p">,</span> <span class="n">auto_start</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">streaming_package_size</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">daisy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">openbci</span><span class="p">):</span>
<span class="c1"># with OpenBCIConsumer(host=&#39;192.168.1.1&#39;) as stream:</span>

    <span class="n">openbci</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">cons</span><span class="o">.</span><span class="n">SAMPLE_RATE_250SPS</span><span class="p">)</span>
    <span class="n">openbci</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">cons</span><span class="o">.</span><span class="n">DEFAULT_CHANNELS_SETTINGS</span><span class="p">)</span>
    <span class="n">openbci</span><span class="o">.</span><span class="n">leadoff_impedance</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">pchan</span><span class="o">=</span><span class="n">cons</span><span class="o">.</span><span class="n">TEST_SIGNAL_NOT_APPLIED</span><span class="p">,</span> <span class="n">nchan</span><span class="o">=</span><span class="n">cons</span><span class="o">.</span><span class="n">TEST_SIGNAL_APPLIED</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">openbci</span><span class="o">.</span><span class="n">start_stream</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">message</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stream</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">topic</span> <span class="o">==</span> <span class="s1">&#39;eeg&#39;</span><span class="p">:</span>

            <span class="n">eeg</span><span class="p">,</span> <span class="n">aux</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
            <span class="n">eeg</span> <span class="o">=</span> <span class="n">filter_impedance</span><span class="p">(</span><span class="n">eeg</span><span class="p">)</span>
<span class="c1">#             eeg = eeg[:, 100:-100]</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">get_z</span><span class="p">(</span><span class="n">eeg</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">Z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">z</span><span class="o">/</span><span class="mi">1000</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> kOhm&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">15</span><span class="p">:</span>
            <span class="k">break</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2.06 kOhm
2.16 kOhm
2.12 kOhm
2.46 kOhm
3.27 kOhm
3.93 kOhm
4.43 kOhm
4.91 kOhm
5.38 kOhm
5.94 kOhm
6.56 kOhm
7.21 kOhm
7.66 kOhm
8.30 kOhm
8.99 kOhm
9.94 kOhm
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Impedance [$K\Omega$]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [s]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_A2-electrodes_impedance_16_0.png" src="../_images/notebooks_A2-electrodes_impedance_16_0.png" />
</div>
</div>
</div>
<div class="section" id="Improve-measurements">
<h2>Improve measurements<a class="headerlink" href="#Improve-measurements" title="Permalink to this headline">¶</a></h2>
<p>Some tips for improving the impedance measurement:</p>
<ul class="simple">
<li><p>Take shorts signals but enough, 1 second is fine.</p></li>
<li><p>Remove the first and last segments of the filtered signal.</p></li>
<li><p>Nonstationary signals will produce wrong measurements.</p></li>
<li><p>A single measurement is not enough, is recommended to work with trends instead.</p></li>
</ul>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo.svg" alt="Logo"/>
            </a></p>
<h3><a href="../index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="00-installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="01-hardware_configurations.html">Hardware configurations</a></li>
<li class="toctree-l1"><a class="reference internal" href="02-kafka_configuration.html">Kafka configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="03-data_acquisition.html">Data Acquisition</a></li>
<li class="toctree-l1"><a class="reference internal" href="04-board_modes.html">Board modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="05-stream_markers.html">Stream markers with Kafka</a></li>
<li class="toctree-l1"><a class="reference internal" href="06-command_line_interface.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="07-data_storage_handler.html">Data storage handler</a></li>
<li class="toctree-l1"><a class="reference internal" href="A1-raw_cleaning.html">Appendix 1 - Raw data processing</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Appendix 2 - Measuring Electrode Impedance</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Offline-measurement">Offline measurement</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Real-time-measurement">Real time measurement</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Improve-measurements">Improve measurements</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="A3-server-based_acquisition.html">Appendix 3 - Raspberry PI as server acquisition</a></li>
<li class="toctree-l1"><a class="reference internal" href="A4-latencies.html">Appendix 4 - System latencies</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019-2021, Yeison Cardona.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.5.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/notebooks/A2-electrodes_impedance.ipynb"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>