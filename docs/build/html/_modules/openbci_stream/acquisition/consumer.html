
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>openbci_stream.acquisition.consumer &#8212; OpenBCI-Stream  documentation</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="shortcut icon" href="../../../_static/favico.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for openbci_stream.acquisition.consumer</h1><div class="highlight"><pre>
<span></span>&quot;&quot;&quot;
================
OpenBCI Consumer
================
&quot;&quot;&quot;

import pickle
import logging
from .cyton import Cyton
from typing import Tuple, Optional, Union, Literal, List

from kafka import KafkaConsumer

# Custom type var
MODE = Literal[&#39;serial&#39;, &#39;wifi&#39;, None]
DAISY = Literal[&#39;auto&#39;, True, False]


########################################################################
<div class="viewcode-block" id="OpenBCIConsumer"><a class="viewcode-back" href="../../openbci_stream.acquisition.consumer.html#openbci_stream.acquisition.consumer.OpenBCIConsumer">[docs]</a>class OpenBCIConsumer:
    &quot;&quot;&quot;Kafka consumer for read data streamed.
    This class can start the acquisition if the respective parameter are
    specified. For just connect with an existing stream only needs the **host**,
    argument, the others one are used for start one.

    Connect with an existing stream:

    &gt;&gt;&gt; whith OpenBCIConsumer() as stream:
            for message in stream:
                ...

    Starts serial acquisition, create a stream and it connects with it:

    &gt;&gt;&gt; whith OpenBCIConsumer(&#39;serial&#39;, &#39;/dev/ttyUSB0&#39;) as stream:
            for message in stream:
                ...

    Connect with a remote existing stream:

    &gt;&gt;&gt; whith OpenBCIConsumer(host=&#39;192.168.1.113&#39;) as stream:
            for message in stream:
                ...

    For examples and descriptions refers to documentation:
    `Controlled execution with OpenBCIConsumer() &lt;../notebooks/03-data_acquisition.html#Controlled-execution-with-OpenBCIConsumer()-class&gt;`_

    Parameters
    ----------
    mode
        If specified, will try to start streaming with this connection mode.
    endpoint
        Serial port for RFduino or IP address for WiFi module.
    daisy
        Daisy board can be detected on runtime or declare it specifically.
    montage
        A list means consecutive channels e.g. `[&#39;Fp1&#39;, &#39;Fp2&#39;, &#39;F3&#39;, &#39;Fz&#39;,
        &#39;F4&#39;]` and a dictionary means specific channels `{1: &#39;Fp1&#39;, 2: &#39;Fp2&#39;,
        3: &#39;F3&#39;, 4: &#39;Fz&#39;, 5: &#39;F4&#39;}`.
    streaming_package_size
        The streamer will try to send packages of this size, this is NOT the
        sampling rate for data acquisition.
    host
        IP address for the server that has the OpenBCI board attached, by
        default its assume that is the same machine where is it executing, this
        is the `localhost`.
    topics
        List of topics to listen.
    auto_start
        If `mode` and `endpoint` are passed, then start the stream automatically.
    &quot;&quot;&quot;

    # ----------------------------------------------------------------------
    def __init__(self, mode: MODE = None, endpoint: Optional[str] = None,
                 daisy: DAISY = &#39;auto&#39;,
                 montage: Optional[Union[list, dict]] = None,
                 streaming_package_size: Optional[int] = 250,
                 host: Optional[str] = &#39;localhost&#39;,
                 topics: Optional[List[str]] = [&#39;eeg&#39;, &#39;marker&#39;, &#39;annotation&#39;],
                 auto_start: Optional[bool] = True) -&gt; None:
        &quot;&quot;&quot;&quot;&quot;&quot;

        self.bootstrap_servers = [f&#39;{host}:9092&#39;]
        self.topics = topics
        self.auto_start = auto_start

        if mode:

            self.openbci = Cyton(mode=mode,
                                 endpoint=endpoint, host=host,
                                 daisy=daisy,
                                 capture_stream=False,
                                 montage=montage,
                                 streaming_package_size=streaming_package_size,
                                 )

    # ----------------------------------------------------------------------
<div class="viewcode-block" id="OpenBCIConsumer.__enter__"><a class="viewcode-back" href="../../openbci_stream.acquisition.consumer.html#openbci_stream.acquisition.consumer.OpenBCIConsumer.__enter__">[docs]</a>    def __enter__(self) -&gt; Tuple[KafkaConsumer, Optional[Cyton]]:
        &quot;&quot;&quot;Start stream and create consumer.&quot;&quot;&quot;

        if hasattr(self, &#39;openbci&#39;) and self.auto_start:
            self.openbci.start_stream()

        self.consumer = KafkaConsumer(bootstrap_servers=self.bootstrap_servers,
                                      value_deserializer=pickle.loads,
                                      auto_offset_reset=&#39;latest&#39;,
                                      )
        self.consumer.subscribe(self.topics)

        if hasattr(self, &#39;openbci&#39;):
            return self.consumer, self.openbci
        else:
            return self.consumer</div>

    # ----------------------------------------------------------------------
<div class="viewcode-block" id="OpenBCIConsumer.__exit__"><a class="viewcode-back" href="../../openbci_stream.acquisition.consumer.html#openbci_stream.acquisition.consumer.OpenBCIConsumer.__exit__">[docs]</a>    def __exit__(self, exc_type: str, exc_val: str, exc_tb: str) -&gt; None:
        &quot;&quot;&quot;Stop stream and close consumer.&quot;&quot;&quot;

        if hasattr(self, &#39;openbci&#39;):
            self.openbci.stop_stream()
        self.consumer.close()

        if exc_type:
            logging.warning(exc_type)
        if exc_val:
            logging.warning(exc_val)
        if exc_tb:
            logging.warning(exc_tb)</div></div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/logo.svg" alt="Logo"/>
            </a></p>
<h3><a href="../../../index.html">Table of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/00-installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/01-hardware_configurations.html">Hardware configurations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/02-kafka_configuration.html">Kafka configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/03-data_acquisition.html">Data Acquisition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/04-board_modes.html">Board modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/05-stream_markers.html">Stream markers with Kafka</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/06-command_line_interface.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/07-data_storage_handler.html">Data storage handler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/A1-raw_cleaning.html">Appendix 1 - Raw data processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/A2-electrodes_impedance.html">Appendix 2 - Measuring Electrode Impedance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/A3-server-based_acquisition.html">Appendix 3 - Raspberry PI as server acquisition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/A4-latencies.html">Appendix 4 - System latencies</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019-2021, Yeison Cardona.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.5.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>